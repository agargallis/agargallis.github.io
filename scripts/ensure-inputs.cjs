const { existsSync, rmSync, statSync } = require("fs");
const { execSync } = require("child_process");
const path = require("path");

const inputs = ["index.html", "resume/index.html", "contact/index.html"];

for (const input of inputs) {
  const fullPath = path.resolve(process.cwd(), input);

  if (!existsSync(fullPath)) {
    try {
      execSync(`git checkout -- ${input}`, { stdio: "inherit" });
    } catch (error) {
      console.warn(`[ensure-inputs] Missing ${input} and failed to restore from git.`);
    }
    continue;
  }

  let stat;
  try {
    stat = statSync(fullPath);
  } catch (error) {
    console.warn(`[ensure-inputs] Failed to stat ${input}.`);
    continue;
  }

  if (stat.isDirectory()) {
    try {
      rmSync(fullPath, { recursive: true, force: true });
      execSync(`git checkout -- ${input}`, { stdio: "inherit" });
    } catch (error) {
      console.warn(`[ensure-inputs] Failed to restore ${input} after removing directory.`);
    }
  }
}
